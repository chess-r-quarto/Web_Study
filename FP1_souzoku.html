<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FP1級 贈与税・相続税計算機</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']]
        },
        svg: { fontCache: 'global' }
      };
    </script>
    <style>
      /* Lichessライクなインプット調整 */
      input[type=number]::-webkit-inner-spin-button,
      input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type=number] {
        -moz-appearance: textfield;
      }
    </style>
  </head>
  <body class="bg-[#edebe9] min-h-screen text-[#333333] font-sans">
    <div id="root"></div>

    <script>
      Babel.registerPreset('tsx', {
        presets: [
          [Babel.availablePresets['typescript'], { isTSX: true, allExtensions: true }],
          Babel.availablePresets['react'],
        ],
      });
    </script>
    
    <script type="text/babel" data-presets="tsx">
      const { useState, useMemo, useEffect, useRef } = React;

      // --- SVG Icons (lucide-react代替) ---
      const InfoIcon = (props: any) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>;
      const UsersIcon = (props: any) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
      const AlertCircleIcon = (props: any) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>;
      const PlusIcon = (props: any) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
      const MinusIcon = (props: any) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="5" y1="12" x2="19" y2="12"/></svg>;
      const CheckIcon = (props: any) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="20 6 9 17 4 12"/></svg>;
      const XIcon = (props: any) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
      const ChevronDownIcon = (props: any) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="6 9 12 15 18 9"/></svg>;
      const ChevronUpIcon = (props: any) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="18 15 12 9 6 15"/></svg>;
      const CalculatorIcon = (props: any) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect x="4" y="2" width="16" height="20" rx="2" ry="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;

      // --- MathJax Component ---
      const Latex: React.FC<{ tex: string, className?: string }> = ({ tex, className = "" }) => {
        const containerRef = useRef<HTMLDivElement>(null);

        useEffect(() => {
          if (containerRef.current) {
            containerRef.current.innerHTML = `$$${tex}$$`;
            if ((window as any).MathJax && (window as any).MathJax.typesetPromise) {
              (window as any).MathJax.typesetPromise([containerRef.current]);
            }
          }
        }, [tex]);

        return <div ref={containerRef} className={`overflow-x-auto overflow-y-hidden text-sm ${className}`} />;
      };

      // --- Logic & Constants ---
      const generalTaxRates = [
        { limit: 200, rate: 0.10, deduction: 0 },
        { limit: 300, rate: 0.15, deduction: 10 },
        { limit: 400, rate: 0.20, deduction: 25 },
        { limit: 600, rate: 0.30, deduction: 65 },
        { limit: 1000, rate: 0.40, deduction: 125 },
        { limit: 1500, rate: 0.45, deduction: 175 },
        { limit: 3000, rate: 0.50, deduction: 250 },
        { limit: Infinity, rate: 0.55, deduction: 400 },
      ];

      const specialTaxRates = [
        { limit: 200, rate: 0.10, deduction: 0 },
        { limit: 400, rate: 0.15, deduction: 10 },
        { limit: 600, rate: 0.20, deduction: 30 },
        { limit: 1000, rate: 0.30, deduction: 90 },
        { limit: 1500, rate: 0.40, deduction: 190 },
        { limit: 3000, rate: 0.45, deduction: 265 },
        { limit: 4500, rate: 0.50, deduction: 415 },
        { limit: Infinity, rate: 0.55, deduction: 640 },
      ];

      const calculateTax = (amount: number, rates: any[]) => {
        const bracket = rates.find(r => amount <= r.limit) || rates[rates.length - 1];
        return {
          tax: (amount * bracket.rate) - bracket.deduction,
          rate: bracket.rate,
          deduction: bracket.deduction
        };
      };

      // --- UI Components ---
      const Card: React.FC<{ title: string, icon: any, children: React.ReactNode, className?: string }> = ({ title, icon: Icon, children, className = "" }) => (
        <div className={`bg-white rounded-sm border border-[#dbd9d6] shadow-sm overflow-hidden ${className}`}>
          <div className="flex items-center gap-2 px-4 py-3 bg-[#f8f7f6] border-b border-[#dbd9d6]">
            <Icon className="w-5 h-5 text-[#666]" />
            <h2 className="text-sm font-semibold text-[#333] uppercase tracking-wider">{title}</h2>
          </div>
          <div className="p-4 md:p-6">
            {children}
          </div>
        </div>
      );

      const NumberInput: React.FC<{ label: string, value: number, onChange: (val: number) => void }> = ({ label, value, onChange }) => (
        <div className="flex flex-col gap-1">
          <label className="text-xs font-bold text-[#666] uppercase tracking-wider">{label}</label>
          <div className="relative">
            <input
              type="number"
              value={value === 0 ? '' : value}
              onChange={(e) => onChange(Number(e.target.value))}
              className="w-full bg-[#e3e1df] border-none rounded-sm p-2.5 text-[#333] focus:ring-2 focus:ring-[#3692e7] outline-none transition-shadow font-mono"
            />
            <span className="absolute right-3 top-2.5 text-[#888] font-bold pointer-events-none text-sm">万円</span>
          </div>
        </div>
      );

      const Counter: React.FC<{ label: string, value: number, onChange: (val: number) => void, min?: number, max?: number, helperText?: string }> = ({ label, value, onChange, min = 0, max = 10, helperText }) => (
        <div className="flex flex-col gap-1">
          <div className="flex justify-between items-end">
            <label className="text-xs font-bold text-[#666] uppercase tracking-wider">{label}</label>
            {helperText && <span className="text-[10px] text-[#888]">{helperText}</span>}
          </div>
          <div className="flex items-center gap-2 bg-[#f8f7f6] p-1.5 border border-[#dbd9d6] rounded-sm">
            <button 
              onClick={() => onChange(Math.max(min, value - 1))}
              disabled={value <= min}
              className="w-8 h-8 flex items-center justify-center bg-white border border-[#dbd9d6] hover:bg-[#e3e1df] disabled:opacity-50 disabled:hover:bg-white rounded-sm transition-colors text-[#333]"
            >
              <MinusIcon className="w-4 h-4" />
            </button>
            <div className="flex-1 text-center font-mono font-semibold text-lg text-[#333]">
              {value}
              <span className="text-xs ml-1 text-[#888] font-sans">名</span>
            </div>
            <button 
              onClick={() => onChange(Math.min(max, value + 1))}
              disabled={value >= max}
              className="w-8 h-8 flex items-center justify-center bg-white border border-[#dbd9d6] hover:bg-[#e3e1df] disabled:opacity-50 disabled:hover:bg-white rounded-sm transition-colors text-[#333]"
            >
              <PlusIcon className="w-4 h-4" />
            </button>
          </div>
        </div>
      );

      // --- Main App ---
      const App: React.FC = () => {
        const [specialGift, setSpecialGift] = useState<number>(400);
        const [generalGift, setGeneralGift] = useState<number>(100);
        const [showGiftLogic, setShowGiftLogic] = useState<boolean>(true);
        
        const [spouse, setSpouse] = useState<boolean>(true);
        const [biologicalChildren, setBiologicalChildren] = useState<number>(2);
        const [adoptedChildren, setAdoptedChildren] = useState<number>(1);
        const [hasBiologicalChild, setHasBiologicalChild] = useState<boolean>(true);
        const [showInheritanceLogic, setShowInheritanceLogic] = useState<boolean>(true);

        const [selectedRel, setSelectedRel] = useState<any>(null);

        useEffect(() => {
          setHasBiologicalChild(biologicalChildren > 0);
        }, [biologicalChildren]);

        const giftResults = useMemo(() => {
          const totalGift = specialGift + generalGift;
          const basicDeduction = 110;
          const taxableAmount = Math.max(0, totalGift - basicDeduction);
          
          if (taxableAmount <= 0) return null;

          const specialRatio = totalGift > 0 ? specialGift / totalGift : 0;
          const generalRatio = totalGift > 0 ? generalGift / totalGift : 0;

          const specialCalc = calculateTax(taxableAmount, specialTaxRates);
          const generalCalc = calculateTax(taxableAmount, generalTaxRates);

          const specialTax = specialCalc.tax * specialRatio;
          const generalTax = generalCalc.tax * generalRatio;
          const totalTax = specialTax + generalTax;

          const texFormula = `
            \\begin{aligned}
            \\text{課税価格} &= ${specialGift} + ${generalGift} - 110 = ${taxableAmount.toFixed(1)} \\text{万円} \\\\
            \\text{特例分} &= (${taxableAmount} \\times ${specialCalc.rate} - ${specialCalc.deduction}) \\times \\frac{${specialGift}}{${totalGift}} \\\\
            &= ${specialCalc.tax.toFixed(4)} \\times ${(specialRatio).toFixed(2)} = ${specialTax.toFixed(4)} \\\\
            \\text{一般分} &= (${taxableAmount} \\times ${generalCalc.rate} - ${generalCalc.deduction}) \\times \\frac{${generalGift}}{${totalGift}} \\\\
            &= ${generalCalc.tax.toFixed(4)} \\times ${(generalRatio).toFixed(2)} = ${generalTax.toFixed(4)} \\\\
            \\text{合計税額} &= ${specialTax.toFixed(4)} + ${generalTax.toFixed(4)} = \\mathbf{${totalTax.toFixed(4)}} \\text{万円}
            \\end{aligned}
          `;

          return { taxableAmount, specialRatio, generalRatio, specialTax, generalTax, totalTax, texFormula };
        }, [specialGift, generalGift]);

        const inheritanceResults = useMemo(() => {
          const maxAdopted = hasBiologicalChild ? 1 : 2;
          const countedAdopted = Math.min(adoptedChildren, maxAdopted);
          const heirCount = (spouse ? 1 : 0) + biologicalChildren + countedAdopted;
          const basicDeduction = 3000 + (600 * heirCount);

          const texFormula = `
            \\begin{aligned}
             \\text{法定相続人} &= ${spouse ? '1(\\text{配})' : '0'} + ${biologicalChildren}(\\text{実}) + \\min(${adoptedChildren}, ${maxAdopted})(\\text{養}) \\\\
             &= ${heirCount} \\text{人} \\\\
             \\text{基礎控除} &= 3,000 + (600 \\times ${heirCount}) \\\\
             &= \\mathbf{${basicDeduction.toLocaleString()}} \\text{万円}
            \\end{aligned}
          `;
          
          return { heirCount, countedAdopted, basicDeduction, texFormula };
        }, [spouse, biologicalChildren, adoptedChildren, hasBiologicalChild]);

        const relationships = [
          { id: 'spouse', label: '配偶者', x: 150, y: 80, type: 'spouse', surcharge: false },
          { id: 'child1', label: '子C (実子)', x: 50, y: 180, type: 'blood1', surcharge: false },
          { id: 'child2', label: '子D (実子)', x: 150, y: 180, type: 'blood1', surcharge: false },
          { id: 'child3', label: '子E (死亡)', x: 250, y: 180, type: 'dead', surcharge: null },
          { id: 'grandchild1', label: '孫F (養子)', x: 50, y: 280, type: 'adopt', surcharge: true },
          { id: 'grandchild2', label: '孫G (代襲)', x: 250, y: 280, type: 'daishu', surcharge: false },
        ];

        return (
          <div className="pb-20">
            <header className="bg-[#262421] text-[#dbd7d1] px-6 py-4 shadow-md sticky top-0 z-20">
              <div className="max-w-5xl mx-auto flex justify-between items-center">
                <h1 className="text-lg font-semibold flex items-center gap-2 text-white">
                  <CalculatorIcon className="w-5 h-5 text-[#3692e7]" />
                  TAX LAW CALCULATOR
                </h1>
                <span className="text-xs font-mono tracking-widest opacity-70 hidden sm:block uppercase">FP 1st Grade Edition</span>
              </div>
            </header>

            <main className="max-w-5xl mx-auto p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
              
              {/* --- LEFT COLUMN: GIFT TAX --- */}
              <div className="space-y-6">
                <Card title="Gift Tax Calculation" icon={InfoIcon}>
                  <div className="space-y-6">
                    <div className="bg-[#f8f7f6] p-4 border-l-4 border-[#3692e7] text-sm">
                      <p className="font-semibold mb-1 text-[#333]">贈与税額控除の按分計算</p>
                      <p className="text-[#666]">特例贈与財産と一般贈与財産がある場合、それぞれの割合に応じて税額を算出します。</p>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                      <NumberInput label="特例贈与 (直系尊属)" value={specialGift} onChange={setSpecialGift} />
                      <NumberInput label="一般贈与 (その他)" value={generalGift} onChange={setGeneralGift} />
                    </div>

                    {giftResults ? (
                      <div className="space-y-6 pt-2">
                        <div className="h-3 flex w-full rounded-sm overflow-hidden bg-[#e3e1df]">
                          <div style={{ width: `${giftResults.specialRatio * 100}%` }} className="bg-[#3692e7] h-full transition-all duration-500 relative group"></div>
                          <div style={{ width: `${giftResults.generalRatio * 100}%` }} className="bg-[#629924] h-full transition-all duration-500 relative group"></div>
                        </div>
                        <div className="flex justify-between text-xs font-bold text-[#666] -mt-4">
                          <span className="text-[#3692e7]">特例 {(giftResults.specialRatio * 100).toFixed(0)}%</span>
                          <span className="text-[#629924]">一般 {(giftResults.generalRatio * 100).toFixed(0)}%</span>
                        </div>

                        <button 
                          onClick={() => setShowGiftLogic(!showGiftLogic)}
                          className="w-full flex items-center justify-between text-xs font-bold uppercase tracking-wider text-[#666] border-b border-[#dbd9d6] pb-2 hover:text-[#333] transition-colors"
                        >
                          <span>Calculation Logic (LaTeX)</span>
                          {showGiftLogic ? <ChevronUpIcon className="w-4 h-4" /> : <ChevronDownIcon className="w-4 h-4" />}
                        </button>

                        {showGiftLogic && (
                          <div className="bg-[#f8f7f6] p-4 border border-[#dbd9d6] rounded-sm">
                            <Latex tex={giftResults.texFormula} />
                          </div>
                        )}

                        <div className="bg-[#262421] text-white p-6 rounded-sm text-center shadow-inner mt-4">
                          <span className="text-xs uppercase tracking-widest opacity-70 block mb-2">Total Tax</span>
                          <span className="text-4xl font-light">
                            {Math.floor(giftResults.totalTax * 10000).toLocaleString()} <span className="text-lg opacity-70">円</span>
                          </span>
                          <span className="text-sm text-[#888] font-mono block mt-1">
                            ({giftResults.totalTax.toFixed(4)} 万円)
                          </span>
                        </div>
                      </div>
                    ) : (
                      <div className="text-center py-8 text-[#888] font-mono bg-[#f8f7f6] rounded-sm border border-[#dbd9d6]">
                        基礎控除以下です
                      </div>
                    )}
                  </div>
                </Card>
              </div>

              {/* --- RIGHT COLUMN: INHERITANCE --- */}
              <div className="space-y-6">
                <Card title="Basic Deduction" icon={UsersIcon}>
                  <div className="space-y-6">
                    <div className="flex items-center justify-between bg-[#f8f7f6] p-4 border border-[#dbd9d6] rounded-sm">
                      <span className="text-sm font-bold uppercase tracking-wider text-[#333]">配偶者の有無</span>
                      <button 
                        onClick={() => setSpouse(!spouse)}
                        className={`w-10 h-10 rounded-sm border transition-all flex items-center justify-center ${spouse ? 'bg-[#3692e7] text-white border-[#3692e7]' : 'bg-[#e3e1df] text-[#888] border-transparent hover:bg-[#d5d3d1]'}`}
                      >
                        {spouse ? <CheckIcon className="w-5 h-5" /> : <MinusIcon className="w-5 h-5" />}
                      </button>
                    </div>

                    <div className="grid grid-cols-2 gap-6">
                      <Counter 
                        label="実子の数"
                        value={biologicalChildren}
                        onChange={(val) => {
                          setBiologicalChildren(val);
                          setHasBiologicalChild(val > 0);
                        }}
                        helperText="制限なし"
                      />
                      <Counter 
                        label="養子の数"
                        value={adoptedChildren}
                        onChange={setAdoptedChildren}
                        helperText={hasBiologicalChild ? "上限1名" : "上限2名"}
                      />
                    </div>

                    <button 
                      onClick={() => setShowInheritanceLogic(!showInheritanceLogic)}
                      className="w-full flex items-center justify-between text-xs font-bold uppercase tracking-wider text-[#666] border-b border-[#dbd9d6] pb-2 hover:text-[#333] transition-colors mt-2"
                    >
                      <span>Calculation Logic (LaTeX)</span>
                      {showInheritanceLogic ? <ChevronUpIcon className="w-4 h-4" /> : <ChevronDownIcon className="w-4 h-4" />}
                    </button>

                    {showInheritanceLogic && (
                      <div className="bg-[#f8f7f6] p-4 border border-[#dbd9d6] rounded-sm">
                        <Latex tex={inheritanceResults.texFormula} />
                        <div className="mt-3 pt-3 border-t border-[#dbd9d6] text-xs font-mono text-[#666]">
                          ※ 民法上の養子数: {adoptedChildren}人 → 税法上の算入数: {inheritanceResults.countedAdopted}人
                          <br/>
                          ({hasBiologicalChild ? '実子がいるため上限1人' : '実子がいないため上限2人'})
                        </div>
                      </div>
                    )}

                    <div className="bg-[#262421] text-white p-6 rounded-sm text-center shadow-inner mt-4">
                      <span className="text-xs uppercase tracking-widest opacity-70 block mb-2">基礎控除額</span>
                      <span className="text-4xl font-light">
                        {inheritanceResults.basicDeduction.toLocaleString()} <span className="text-lg opacity-70">万円</span>
                      </span>
                    </div>
                  </div>
                </Card>

                <Card title="20% Surcharge Check" icon={AlertCircleIcon}>
                  <p className="text-xs font-bold uppercase tracking-wider text-[#666] mb-3">
                    Interactive Diagram
                  </p>
                  <div className="h-80 w-full bg-[#f8f7f6] border border-[#dbd9d6] rounded-sm relative overflow-hidden select-none">
                    <svg className="absolute inset-0 w-full h-full pointer-events-none">
                      <line x1="150" y1="40" x2="150" y2="80" stroke="#dbd9d6" strokeWidth="2" />
                      <line x1="150" y1="40" x2="50" y2="180" stroke="#dbd9d6" strokeWidth="2" />
                      <line x1="150" y1="40" x2="150" y2="180" stroke="#dbd9d6" strokeWidth="2" />
                      <line x1="150" y1="40" x2="250" y2="180" stroke="#dbd9d6" strokeWidth="2" />
                      
                      <line x1="50" y1="180" x2="50" y2="280" stroke="#dbd9d6" strokeWidth="2" />
                      <line x1="250" y1="180" x2="250" y2="280" stroke="#dbd9d6" strokeWidth="2" strokeDasharray="4" />
                    </svg>

                    <div className="absolute top-4 left-1/2 -translate-x-1/2 flex flex-col items-center group cursor-default">
                      <div className="w-10 h-10 bg-[#262421] text-white rounded-full flex items-center justify-center font-bold text-sm z-10 shadow-sm ring-2 ring-white transition-transform group-hover:scale-105">
                        A
                      </div>
                      <span className="text-[10px] font-bold mt-1 text-[#888] uppercase tracking-widest">Decedant</span>
                    </div>

                    {relationships.map((rel) => {
                      const isSelected = selectedRel?.id === rel.id;
                      const isDead = rel.type === 'dead';
                      return (
                        <button
                          key={rel.id}
                          onClick={() => !isDead && setSelectedRel(rel)}
                          style={{ top: rel.y, left: rel.x }}
                          className={`
                            absolute -translate-x-1/2 w-20 p-2 rounded-sm border transition-all duration-300 z-10 flex flex-col items-center gap-1
                            ${isDead ? 'border-[#dbd9d6] bg-[#edebe9] opacity-50 cursor-not-allowed border-dashed' : 'cursor-pointer'}
                            ${isSelected ? 'border-[#3692e7] bg-[#e6f3ff] shadow-sm scale-105' : 'border-[#dbd9d6] bg-white hover:border-[#b4b2af]'}
                          `}
                        >
                          <span className={`text-xs font-bold leading-tight ${isDead ? 'text-[#888]' : 'text-[#333]'}`}>{rel.label}</span>
                          {isDead && <span className="text-[9px] text-[#db5555] font-bold uppercase tracking-widest">Deceased</span>}
                        </button>
                      );
                    })}

                    {selectedRel && (
                      <div className="absolute bottom-4 left-4 right-4 bg-white border border-[#dbd9d6] p-4 shadow-md rounded-sm">
                        <div className="flex justify-between items-start">
                          <div>
                            <h3 className="font-bold text-sm mb-1 flex items-center gap-2 text-[#333]">
                              {selectedRel.label}
                              <span className="text-[10px] bg-[#e3e1df] text-[#666] px-2 py-0.5 rounded-sm uppercase tracking-wider">{selectedRel.type}</span>
                            </h3>
                            <div className="flex items-center gap-2 mb-2">
                              {selectedRel.surcharge ? (
                                <span className="flex items-center gap-1 text-[#db5555] font-bold text-xs bg-[#fdf0f0] px-2 py-1 rounded-sm border border-[#fad4d4]">
                                  <AlertCircleIcon className="w-3 h-3" /> 2割加算 対象
                                </span>
                              ) : (
                                <span className="flex items-center gap-1 text-[#629924] font-bold text-xs bg-[#f2f8ec] px-2 py-1 rounded-sm border border-[#d3e8b8]">
                                  <CheckIcon className="w-3 h-3" /> 2割加算 対象外
                                </span>
                              )}
                            </div>
                            <p className="text-xs text-[#666] leading-relaxed font-mono">
                              {selectedRel.type === 'adopt' && "孫養子: 一親等の血族だが、代襲相続人でないため租税回避防止規定により2割加算対象。"}
                              {selectedRel.type === 'daishu' && "代襲相続人: 直系卑属として実子と同等の地位を承継するため2割加算対象外。"}
                              {selectedRel.type === 'spouse' && "配偶者: 常に相続人となり、2割加算の対象外。"}
                              {selectedRel.type === 'blood1' && "一親等の血族: 実子・父母は2割加算の対象外。"}
                            </p>
                          </div>
                          <button onClick={() => setSelectedRel(null)} className="text-[#888] hover:text-[#333] transition-colors p-1 hover:bg-[#f8f7f6] rounded-sm">
                            <XIcon className="w-4 h-4" />
                          </button>
                        </div>
                      </div>
                    )}
                  </div>
                </Card>
              </div>
            </main>
            
            <footer className="max-w-5xl mx-auto px-6 pt-10 text-center text-[#888] text-[10px] font-mono tracking-[0.2em] uppercase">
              © 2026 Inheritance Tax Calculator / Minimalist Design
            </footer>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root')!);
      root.render(<App />);
    </script>
  </body>
</html>
